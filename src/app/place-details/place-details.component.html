<div class="w-full h-full flex flex-col items-center justify-center pt-12">
  <div #container class="flex flex-row w-full h-[80vh]" *ngIf="placeDetails">
    <app-videos
      [photos]="photos"
      [pid]="pid"
      [reviews]="reviews"
      class="lg:w-1/3 w-1/2 shrink-0 mx-2"
    ></app-videos>

    <div class="lg:w-2/3 w-1/2 h-full overflow-y-scroll mx-2 pr-2">
      <h2 class="text-3xl font-semibold">
        {{ placeDetails.name }}
      </h2>
      <div class="flex items-center justify-start mt-2">
        <img
          src="{{ placeDetails.icon }}"
          alt="Place Icon"
          class="mr-2 w-5 h-5 inline-block"
        />
        <div class="flex" *ngIf="placeDetails.rating">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            class="inline-block w-6 h-6 mr-1"
            *ngFor="let i of [1, 2, 3, 4, 5]"
          >
            <path
              [ngClass]="{
                'text-yellow-500': placeDetails.rating >= i,
                'text-gray-300': placeDetails.rating < i
              }"
              fill="currentColor"
              d="m9.362 9.158l-5.268.584c-.19.023-.358.15-.421.343s0
          .394.14.521c1.566 1.429 3.919 3.569 3.919 3.569c-.002 0-.646
          3.113-1.074 5.19a.496.496 0 0 0 .734.534c1.844-1.048 4.606-2.624
          4.606-2.624l4.604 2.625c.168.092.378.09.541-.029a.5.5 0 0 0
          .195-.505l-1.071-5.191l3.919-3.566a.499.499 0 0
          0-.28-.865c-2.108-.236-5.269-.586-5.269-.586l-2.183-4.83a.499.499 0 0
          0-.909 0l-2.183 4.83z"
            />
          </svg>
        </div>
      </div>
      <div class="text-md text-gray-700 mt-2">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          class="inline-block w-6 h-6"
          viewBox="0 0 24 24"
        >
          <path
            fill="currentColor"
            d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm0
        9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"
          />
        </svg>
        <span>
          {{ placeDetails.formatted_address }}
        </span>
      </div>

      <div class="flex flex-row items-center justify-between mt-4">
        <h3 class="text-xl font-semibold mt-4">
          Reviews ({{ placeDetails.reviews?.length }})
        </h3>

        <button
          class="bg-sky-500 hover:bg-sky-600 text-white font-semibold text-sm py-2 px-4 rounded inline-flex items-center h-10"
          (click)="toggleWriteReview()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            class="inline-block w-6 h-6 mr-3 p-1"
          >
            <path
              fill="currentColor"
              d="M3 21v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15q.4 0 .775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM17.6 7.8L19 6.4L17.6 5l-1.4 1.4z"
            />
          </svg>
          <span>Review</span>
        </button>
      </div>

      <app-write-review *ngIf="showWriteReview" [pid]="pid"></app-write-review>

      <div
        class="flex flex-col w-full bg-gray-100 rounded-lg p-4 mt-4"
        *ngFor="let review of reviews"
      >
        <div class="flex flex-row items-center">
          <img
            src="{{ review.uid }}"
            alt="Profile Photo"
            class="w-12 h-12 rounded-full mr-4"
            *ngIf="false"
          />
          <svg
            *ngIf="true"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            class="inline-block w-12 h-12 mr-4 p-2 text-gray-500 rounded-full bg-gray-300"
          >
            <path
              fill="currentColor"
              d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12m-8 8v-2.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20z"
            />
          </svg>
          <span class="font-bold text-sm"> {{ review.uid }} </span>
          <div
            class="flex flex-row items-center justify-end grow text-sm ml-auto"
          >
            {{
              strToDate(review.createdAt).toLocaleDateString("en-US", {
                year: "numeric",
                month: "short",
                day: "numeric"
              })
            }}
          </div>
        </div>

        <div class="flex flex-row items-center my-3" *ngIf="review.rating">
          <span
            *ngFor="let i of [1, 2, 3, 4, 5]"
            class="w-8 h-5 ml-1 rounded-md"
            [ngClass]="{
              'bg-red-500': review.rating < 3 && i <= review.rating,
              'bg-yellow-500':
                review.rating >= 3 && review.rating < 4 && i <= review.rating,
              'bg-green-500': review.rating >= 4 && i <= review.rating,
              'bg-gray-300': i > review.rating
            }"
          ></span>
        </div>
        <p class="text-md my-4 text-ellipsis line-clamp-3">{{ review.text }}</p>
      </div>

      <div
        class="flex flex-col w-full bg-gray-100 rounded-lg p-4 mt-4"
        *ngFor="let review of placeDetails.reviews"
      >
        <div class="flex flex-row items-center">
          <img
            src="{{ review.profile_photo_url }}"
            alt="Profile Photo"
            class="w-12 h-12 rounded-full mr-4"
          />
          <span class="font-bold text-sm"> {{ review.author_name }} </span>
          <div
            class="flex flex-row items-center justify-end grow text-sm ml-auto"
          >
            {{ review.relative_time_description }}
          </div>
        </div>

        <div class="flex flex-row items-center my-3" *ngIf="review.rating">
          <span
            *ngFor="let i of [1, 2, 3, 4, 5]"
            class="w-8 h-5 ml-1 rounded-md"
            [ngClass]="{
              'bg-red-500': review.rating < 3 && i <= review.rating,
              'bg-yellow-500':
                review.rating >= 3 && review.rating < 4 && i <= review.rating,
              'bg-green-500': review.rating >= 4 && i <= review.rating,
              'bg-gray-300': i > review.rating
            }"
          ></span>
        </div>
        <p class="text-md my-4 text-ellipsis line-clamp-3">{{ review.text }}</p>
      </div>
    </div>
  </div>
</div>
